<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Screen é…ç½®ç®¡ç†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.2); }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="glass rounded-3xl shadow-2xl max-w-4xl w-full p-8">
        <div class="flex items-center justify-between mb-8">
            <div>
                <h1 class="text-3xl font-bold text-white mb-2">ğŸ–¥ï¸ Smart Screen é…ç½®ç®¡ç†</h1>
                <p class="text-white/70">è¿œç¨‹æ§åˆ¶æ˜¾ç¤ºå±å‚æ•°å’Œæ¼”ç¤ºæ¨¡å¼</p>
            </div>
            <div class="text-right">
                <div id="status" class="text-sm text-white/60">åŠ è½½ä¸­...</div>
                <div id="lastUpdate" class="text-xs text-white/40 mt-1"></div>
            </div>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
            <div class="glass rounded-2xl p-6">
                <h2 class="text-xl font-semibold text-white mb-4">ğŸ  Home Assistant</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-white/80 mb-2">HA URL</label>
                        <input id="ha_url" type="text" placeholder="http://192.168.1.100:8123" 
                            class="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:border-white/50">
                    </div>
                    <div>
                        <label class="block text-sm text-white/80 mb-2">Access Token</label>
                        <input id="ha_token" type="password" placeholder="Long-lived access token" 
                            class="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:border-white/50">
                    </div>
                    <div>
                        <label class="block text-sm text-white/80 mb-2">å¤©æ°”å®ä½“ ID</label>
                        <input id="weather_entity" type="text" placeholder="weather.forecast_home" 
                            class="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:border-white/50">
                    </div>
                    <div>
                        <label class="block text-sm text-white/80 mb-2">ä½ç½®åç§°</label>
                        <input id="location_name" type="text" placeholder="ç½—åº„åŒº" 
                            class="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:border-white/50">
                    </div>
                </div>
            </div>

            <div class="glass rounded-2xl p-6">
                <h2 class="text-xl font-semibold text-white mb-4">ğŸ¬ æ¼”ç¤ºæ¨¡å¼</h2>
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-4 bg-white/5 rounded-lg">
                        <span class="text-white">å¯ç”¨æ¼”ç¤ºæ¨¡å¼</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input id="demo_mode" type="checkbox" class="sr-only peer">
                            <div class="w-11 h-6 bg-white/20 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div>
                        </label>
                    </div>
                    <div>
                        <label class="block text-sm text-white/80 mb-2">å¤©æ°”çŠ¶æ€</label>
                        <select id="demo_state" class="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:border-white/50">
                            <option value="CLEAR_DAY">â˜€ï¸ æ™´å¤©</option>
                            <option value="CLEAR_NIGHT">ğŸŒ™ æ™´å¤œ</option>
                            <option value="PARTLY_CLOUDY_DAY">ğŸŒ¤ï¸ å¤šäº‘(æ—¥)</option>
                            <option value="PARTLY_CLOUDY_NIGHT">â˜ï¸ å¤šäº‘(å¤œ)</option>
                            <option value="CLOUDY">â˜ï¸ é˜´å¤©</option>
                            <option value="LIGHT_RAIN">ğŸŒ¦ï¸ å°é›¨</option>
                            <option value="MODERATE_RAIN">ğŸŒ§ï¸ ä¸­é›¨</option>
                            <option value="HEAVY_RAIN">ğŸŒ§ï¸ å¤§é›¨</option>
                            <option value="STORM_RAIN">â›ˆï¸ æš´é›¨</option>
                            <option value="LIGHT_SNOW">ğŸŒ¨ï¸ å°é›ª</option>
                            <option value="MODERATE_SNOW">â„ï¸ ä¸­é›ª</option>
                            <option value="HEAVY_SNOW">â„ï¸ å¤§é›ª</option>
                            <option value="STORM_SNOW">â„ï¸ æš´é›ª</option>
                            <option value="THUNDER_SHOWER">â›ˆï¸ é›·é˜µé›¨</option>
                            <option value="HAIL">ğŸ§Š å†°é›¹</option>
                            <option value="SLEET">ğŸŒ¨ï¸ é›¨å¤¹é›ª</option>
                            <option value="WIND">ğŸ’¨ å¤§é£</option>
                            <option value="LIGHT_HAZE">ğŸŒ«ï¸ è½»é›¾</option>
                            <option value="MODERATE_HAZE">ğŸŒ«ï¸ ä¸­é›¾</option>
                            <option value="HEAVY_HAZE">ğŸŒ«ï¸ å¤§é›¾</option>
                            <option value="FOG">ğŸŒ«ï¸ é›¾</option>
                            <option value="DUST">ğŸ’¨ æµ®å°˜</option>
                            <option value="SAND">ğŸ’¨ æ²™å°˜</option>
                        </select>
                    </div>
                    <div class="p-4 bg-blue-500/20 rounded-lg border border-blue-400/30">
                        <p class="text-sm text-blue-100">ğŸ’¡ æ¼”ç¤ºæ¨¡å¼ä¸‹ä¸ä¼šè¿æ¥ Home Assistantï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®å±•ç¤ºå¤©æ°”æ•ˆæœ</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex gap-4 mt-8">
            <button onclick="loadConfig()" class="flex-1 px-6 py-3 bg-white/20 hover:bg-white/30 text-white rounded-xl font-semibold transition-all">
                ğŸ”„ åˆ·æ–°é…ç½®
            </button>
            <button onclick="saveConfig()" class="flex-1 px-6 py-3 bg-green-500 hover:bg-green-600 text-white rounded-xl font-semibold transition-all shadow-lg">
                ğŸ’¾ ä¿å­˜é…ç½®
            </button>
        </div>

        <div class="mt-6 glass rounded-2xl p-6">
            <h3 class="text-lg font-semibold text-white mb-4">âš¡ å¿«é€Ÿæ“ä½œ</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                <button onclick="quickDemo('CLEAR_DAY')" class="px-4 py-2 bg-yellow-500/30 hover:bg-yellow-500/50 text-white rounded-lg text-sm transition-all">â˜€ï¸ æ™´å¤©</button>
                <button onclick="quickDemo('HEAVY_RAIN')" class="px-4 py-2 bg-blue-500/30 hover:bg-blue-500/50 text-white rounded-lg text-sm transition-all">ğŸŒ§ï¸ å¤§é›¨</button>
                <button onclick="quickDemo('HEAVY_SNOW')" class="px-4 py-2 bg-cyan-500/30 hover:bg-cyan-500/50 text-white rounded-lg text-sm transition-all">â„ï¸ å¤§é›ª</button>
                <button onclick="quickDemo('THUNDER_SHOWER')" class="px-4 py-2 bg-purple-500/30 hover:bg-purple-500/50 text-white rounded-lg text-sm transition-all">â›ˆï¸ é›·é›¨</button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = '/api/config';

        async function loadConfig() {
            try {
                const res = await fetch(API_URL);
                const config = await res.json();
                
                document.getElementById('ha_url').value = config.ha_url || '';
                document.getElementById('ha_token').value = config.ha_token || '';
                document.getElementById('weather_entity').value = config.weather_entity || 'weather.forecast_home';
                document.getElementById('location_name').value = config.location_name || 'ç½—åº„åŒº';
                document.getElementById('demo_mode').checked = config.demo_mode || false;
                document.getElementById('demo_state').value = config.demo_state || 'CLEAR_DAY';
                
                document.getElementById('status').textContent = 'âœ… å·²è¿æ¥';
                document.getElementById('lastUpdate').textContent = 'æœ€åæ›´æ–°: ' + new Date().toLocaleTimeString('zh-CN');
            } catch (error) {
                document.getElementById('status').textContent = 'âŒ è¿æ¥å¤±è´¥';
                console.error('Load failed:', error);
            }
        }

        async function saveConfig() {
            const config = {
                ha_url: document.getElementById('ha_url').value,
                ha_token: document.getElementById('ha_token').value,
                weather_entity: document.getElementById('weather_entity').value,
                location_name: document.getElementById('location_name').value,
                demo_mode: document.getElementById('demo_mode').checked,
                demo_state: document.getElementById('demo_state').value
            };

            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });
                
                if (res.ok) {
                    document.getElementById('status').textContent = 'âœ… ä¿å­˜æˆåŠŸ';
                    setTimeout(() => loadConfig(), 500);
                }
            } catch (error) {
                document.getElementById('status').textContent = 'âŒ ä¿å­˜å¤±è´¥';
                console.error('Save failed:', error);
            }
        }

        async function quickDemo(state) {
            document.getElementById('demo_mode').checked = true;
            document.getElementById('demo_state').value = state;
            await saveConfig();
        }

        loadConfig();
        setInterval(loadConfig, 30000);
    </script>
</body>
</html>
